generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Org {
  id        String   @id @default(cuid())
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  agencies  Agency[]
  people    Person[]
  roles     OrgRole[]
}

model OrgRole {
  id          String               @id @default(cuid())
  orgId       String
  key         String
  name        String
  isSystem    Boolean              @default(true)
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt
  org         Org                  @relation(fields: [orgId], references: [id], onDelete: Cascade)
  permissions OrgRolePermission[]
  assignments PersonOrgRole[]

  @@unique([orgId, key])
  @@index([orgId])
}

model OrgRolePermission {
  id         String  @id @default(cuid())
  roleId     String
  permission String
  role       OrgRole @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([roleId, permission])
  @@index([roleId])
}

model PersonOrgRole {
  id        String   @id @default(cuid())
  personId  String
  roleId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  person    Person   @relation(fields: [personId], references: [id], onDelete: Cascade)
  role      OrgRole  @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([personId, roleId])
  @@index([personId])
  @@index([roleId])
}

model Agency {
  id                        String                     @id @default(cuid())
  orgId                     String
  name                      String
  profileName               String?
  ownerName                 String?
  address                   String?
  createdAt                 DateTime                   @default(now())
  updatedAt                 DateTime                   @updatedAt
  org                       Org                        @relation(fields: [orgId], references: [id], onDelete: Cascade)
  activityTypes             ActivityType[]
  activityRecords           ActivityRecord[]
  activityEvents            ActivityEvent[]
  activityTargets           ActivityTarget[]
  commissionPlans           CommissionPlan[]
  compPlans                 CompPlan[]
  households                Household[]
  householdFieldDefinitions HouseholdFieldDefinition[]
  linesOfBusiness           LineOfBusiness[]
  marketingSourceOptions    MarketingSourceOption[]
  peoplePrimary             Person[]                   @relation("PrimaryAgency")
  memberships               PersonAgencyMembership[]
  premiumBuckets            PremiumBucket[]
  productionExpectations    ProductionExpectation[]
  compMonthlyResults        CompMonthlyResult[]
  reportPresets             ReportPreset[]
  reportSnapshots           ReportSnapshot[]
  benchOfficePlans          BenchOfficePlan[]
  soldProducts              SoldProduct[]
  teams                     Team[]
  valuePolicyDefaults       ValuePolicyDefault[]
  winTheDayPlans            WinTheDayPlan[]

  @@index([orgId])
}

model LineOfBusiness {
  id                     String                  @id @default(cuid())
  agencyId               String
  name                   String
  premiumCategory        PremiumCategory
  createdAt              DateTime                @default(now())
  updatedAt              DateTime                @updatedAt
  agency                 Agency                  @relation(fields: [agencyId], references: [id], onDelete: Cascade)
  products               Product[]
  productionExpectations ProductionExpectation[]

  @@unique([agencyId, name])
}

model Product {
  id               String         @id @default(cuid())
  lineOfBusinessId String
  name             String
  productType      ProductType
  isActive         Boolean        @default(true)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  lineOfBusiness   LineOfBusiness @relation(fields: [lineOfBusinessId], references: [id], onDelete: Cascade)
  soldProducts     SoldProduct[]

  @@unique([lineOfBusinessId, name])
}

model Household {
  id              String                @id @default(cuid())
  agencyId        String
  firstName       String
  lastName        String
  ecrmLink        String?
  marketingSource String?
  onboarded       Boolean               @default(false)
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt
  agency          Agency                @relation(fields: [agencyId], references: [id], onDelete: Cascade)
  fieldValues     HouseholdFieldValue[]
  soldProducts    SoldProduct[]

  @@index([agencyId, lastName, firstName])
}

model SoldProduct {
  id              String       @id @default(cuid())
  agencyId        String
  productId       String
  householdId     String
  soldByName      String?
  soldByPersonId  String?
  dateSold        DateTime
  premium         Float
  status          PolicyStatus @default(WRITTEN)
  isValueHealth   Boolean      @default(false)
  isValueLife     Boolean      @default(false)
  policyFirstName String?
  policyLastName  String?
  policyId        String?
  notes           String?
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  agency          Agency       @relation(fields: [agencyId], references: [id], onDelete: Cascade)
  household       Household    @relation(fields: [householdId], references: [id], onDelete: Cascade)
  product         Product      @relation(fields: [productId], references: [id], onDelete: Cascade)
  soldByPerson    Person?      @relation(fields: [soldByPersonId], references: [id], onDelete: SetNull)

  @@index([agencyId, dateSold])
  @@index([productId, dateSold])
  @@index([householdId, dateSold])
  @@index([soldByName, dateSold])
  @@index([soldByPersonId, dateSold])
}

model ActivityRecord {
  id           String   @id @default(cuid())
  personName   String?
  personId     String?
  agencyId     String?
  activityDate DateTime
  activityName String
  count        Int
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  agency       Agency?  @relation(fields: [agencyId], references: [id], onDelete: SetNull)
  person       Person?  @relation(fields: [personId], references: [id], onDelete: SetNull)

  @@index([agencyId, activityDate])
  @@index([personName, activityDate])
  @@index([personId, activityDate])
}

model ActivityEvent {
  id             String       @id @default(cuid())
  activityTypeId String
  personId       String
  agencyId       String
  occurredAt     DateTime
  meta           Json?
  createdAt      DateTime     @default(now())
  activityType   ActivityType @relation(fields: [activityTypeId], references: [id], onDelete: Cascade)
  agency         Agency       @relation(fields: [agencyId], references: [id], onDelete: Cascade)
  person         Person       @relation(fields: [personId], references: [id], onDelete: Cascade)

  @@index([agencyId, occurredAt])
  @@index([activityTypeId, occurredAt])
  @@index([personId, occurredAt])
}

model ActivityTarget {
  id             String       @id @default(cuid())
  activityTypeId String
  personId       String
  agencyId       String
  monthlyMinimum Int          @default(0)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  activityType   ActivityType @relation(fields: [activityTypeId], references: [id], onDelete: Cascade)
  agency         Agency       @relation(fields: [agencyId], references: [id], onDelete: Cascade)
  person         Person       @relation(fields: [personId], references: [id], onDelete: Cascade)

  @@index([agencyId])
  @@unique([agencyId, activityTypeId, personId])
  @@index([personId])
}

model Person {
  id                   String                         @id @default(cuid())
  fullName             String
  email                String?
  teamType             TeamType
  active               Boolean                        @default(true)
  teamId               String?
  roleId               String?
  orgId                String
  primaryAgencyId      String?
  isAdmin              Boolean                        @default(false)
  isManager            Boolean                        @default(false)
  createdAt            DateTime                       @default(now())
  updatedAt            DateTime                       @updatedAt
  activityEvents       ActivityEvent[]
  activityRecords      ActivityRecord[]
  activityTargets      ActivityTarget[]
  createdActivityTypes ActivityType[]
  commissionPlans      CommissionPlan[]
  planAssignments      CommissionPlanAssignment[]
  memberships          PersonAgencyMembership[]
  orgRoles             PersonOrgRole[]
  org                  Org                            @relation(fields: [orgId], references: [id], onDelete: Cascade)
  primaryAgency        Agency?                        @relation("PrimaryAgency", fields: [primaryAgencyId], references: [id], onDelete: SetNull)
  role                 Role?                          @relation(fields: [roleId], references: [id], onDelete: SetNull)
  team                 Team?                          @relation(fields: [teamId], references: [id], onDelete: SetNull)
  roiCompPlans         RoiCompPlan[]
  roiMonthlyInputs     RoiMonthlyInputs[]
  soldProducts         SoldProduct[]
  winAssignments       WinTheDayPlanPersonAssignment?
  benchOverride        BenchPersonOverride?

  @@index([orgId])
}

model PersonAgencyMembership {
  id        String   @id @default(cuid())
  personId  String
  agencyId  String
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  person    Person   @relation(fields: [personId], references: [id], onDelete: Cascade)
  agency    Agency   @relation(fields: [agencyId], references: [id], onDelete: Cascade)

  @@unique([personId, agencyId])
  @@index([personId])
  @@index([agencyId])
}

model MarketingSourceOption {
  id        String   @id @default(cuid())
  agencyId  String
  name      String   @unique
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  agency    Agency   @relation(fields: [agencyId], references: [id], onDelete: Cascade)

  @@index([agencyId, active])
}

model HouseholdFieldDefinition {
  id        String                @id @default(cuid())
  agencyId  String
  fieldName String
  fieldType String
  required  Boolean               @default(false)
  active    Boolean               @default(true)
  createdAt DateTime              @default(now())
  updatedAt DateTime              @updatedAt
  charLimit Int?
  options   Json?
  agency    Agency                @relation(fields: [agencyId], references: [id], onDelete: Cascade)
  values    HouseholdFieldValue[]

  @@unique([agencyId, fieldName])
  @@index([agencyId, active])
}

model HouseholdFieldValue {
  id                String                   @id @default(cuid())
  householdId       String
  fieldDefinitionId String
  value             String
  createdAt         DateTime                 @default(now())
  updatedAt         DateTime                 @updatedAt
  fieldDefinition   HouseholdFieldDefinition @relation(fields: [fieldDefinitionId], references: [id], onDelete: Cascade)
  household         Household                @relation(fields: [householdId], references: [id], onDelete: Cascade)

  @@index([householdId])
  @@index([fieldDefinitionId])
}

model Team {
  id                   String                       @id @default(cuid())
  agencyId             String
  name                 String
  active               Boolean                      @default(true)
  createdAt            DateTime                     @default(now())
  updatedAt            DateTime                     @updatedAt
  activityExpectations ActivityDailyExpectation[]
  activityVisibilities ActivityTeamVisibility[]
  commissionPlans      CommissionPlan[]
  people               Person[]
  roles                Role[]
  agency               Agency                       @relation(fields: [agencyId], references: [id], onDelete: Cascade)
  winAssignments       WinTheDayPlanTeamAssignment?

  @@unique([agencyId, name])
}

model Role {
  id                     String                  @id @default(cuid())
  teamId                 String
  name                   String
  active                 Boolean                 @default(true)
  createdAt              DateTime                @default(now())
  updatedAt              DateTime                @updatedAt
  commissionPlans        CommissionPlan[]
  people                 Person[]
  productionExpectations ProductionExpectation[]
  team                   Team                    @relation(fields: [teamId], references: [id], onDelete: Cascade)
  benchExpectation       BenchRoleExpectation?

  @@unique([teamId, name])
}

model PremiumBucket {
  id               String   @id @default(cuid())
  agencyId         String
  name             String
  description      String?
  includesLobs     String[]
  includesProducts String[]
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  agency           Agency   @relation(fields: [agencyId], references: [id], onDelete: Cascade)

  @@unique([agencyId, name])
}

model ValuePolicyDefault {
  id             String   @id @default(cuid())
  agencyId       String
  lineOfBusiness String
  flagField      String
  threshold      Float
  notes          String?
  active         Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  agency         Agency   @relation(fields: [agencyId], references: [id], onDelete: Cascade)

  @@unique([agencyId, flagField, lineOfBusiness])
}

model CommissionPlan {
  id                   String                     @id @default(cuid())
  agencyId             String?
  name                 String
  scope                CommissionScope
  teamId               String?
  roleId               String?
  personId             String?
  teamType             TeamType?
  isDefaultForTeamType Boolean                    @default(false)
  effectiveFrom        DateTime                   @default(now())
  createdAt            DateTime                   @default(now())
  updatedAt            DateTime                   @updatedAt
  components           CommissionComponent[]
  agency               Agency?                    @relation(fields: [agencyId], references: [id], onDelete: Cascade)
  person               Person?                    @relation(fields: [personId], references: [id], onDelete: SetNull)
  role                 Role?                      @relation(fields: [roleId], references: [id], onDelete: SetNull)
  team                 Team?                      @relation(fields: [teamId], references: [id], onDelete: SetNull)
  assignments          CommissionPlanAssignment[]

  @@index([agencyId])
  @@index([teamId])
  @@index([roleId])
  @@index([personId])
  @@index([teamType])
}

model CommissionComponent {
  id            String         @id @default(cuid())
  planId        String
  name          String
  componentType String
  config        Json
  displayOrder  Int            @default(0)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  plan          CommissionPlan @relation(fields: [planId], references: [id], onDelete: Cascade)

  @@index([planId])
}

model CommissionPlanAssignment {
  id            String         @id @default(cuid())
  personId      String
  planId        String
  effectiveFrom DateTime       @default(now())
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  person        Person         @relation(fields: [personId], references: [id], onDelete: Cascade)
  plan          CommissionPlan @relation(fields: [planId], references: [id], onDelete: Cascade)

  @@unique([personId, planId, effectiveFrom])
  @@index([personId])
}

model ActivityType {
  id                     String                     @id @default(cuid())
  agencyId               String
  name                   String
  description            String?
  active                 Boolean                    @default(true)
  inputMode              ActivityInputMode          @default(COUNT)
  unitLabel              String?
  requiresFullName       Boolean                    @default(false)
  payable                Boolean                    @default(false)
  payoutMode             String?
  flatPayoutValue        Float?
  trackOnly              Boolean                    @default(true)
  defaultQuotaPerDay     Int?
  groupingHint           ActivityGroupingHint?
  createdAt              DateTime                   @default(now())
  updatedAt              DateTime                   @updatedAt
  orgId                  String?
  category               String?
  isActive               Boolean                    @default(true)
  createdByPersonId      String?
  expectations           ActivityDailyExpectation[]
  events                 ActivityEvent[]
  payoutTiers            ActivityPayoutTier[]
  targets                ActivityTarget[]
  visibilities           ActivityTeamVisibility[]
  agency                 Agency                     @relation(fields: [agencyId], references: [id], onDelete: Cascade)
  createdByPerson        Person?                    @relation(fields: [createdByPersonId], references: [id], onDelete: SetNull)
  productionExpectations ProductionExpectation[]
  winRules               WinTheDayRule[]

  @@unique([agencyId, name])
  @@index([agencyId, active])
}

model ActivityTeamVisibility {
  id               String       @id @default(cuid())
  activityTypeId   String
  teamId           String
  canUse           Boolean      @default(true)
  isDefaultForTeam Boolean      @default(false)
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  activityType     ActivityType @relation(fields: [activityTypeId], references: [id], onDelete: Cascade)
  team             Team         @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@unique([activityTypeId, teamId])
  @@index([teamId])
}

model ActivityDailyExpectation {
  id             String       @id @default(cuid())
  activityTypeId String
  teamId         String
  expectedPerDay Int?
  required       Boolean      @default(false)
  notes          String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  activityType   ActivityType @relation(fields: [activityTypeId], references: [id], onDelete: Cascade)
  team           Team         @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@unique([activityTypeId, teamId])
  @@index([teamId])
}

model ActivityPayoutTier {
  id             String       @id @default(cuid())
  activityTypeId String
  minValue       Float
  maxValue       Float?
  payoutValue    Float
  orderIndex     Int          @default(0)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  activityType   ActivityType @relation(fields: [activityTypeId], references: [id], onDelete: Cascade)

  @@index([activityTypeId])
}

model WinTheDayPlan {
  id                String                          @id @default(cuid())
  agencyId          String?
  name              String
  pointsToWin       Int
  active            Boolean                         @default(true)
  archivedAt        DateTime?
  createdAt         DateTime                        @default(now())
  updatedAt         DateTime                        @updatedAt
  agency            Agency?                         @relation(fields: [agencyId], references: [id], onDelete: Cascade)
  personAssignments WinTheDayPlanPersonAssignment[]
  teamAssignments   WinTheDayPlanTeamAssignment[]
  rules             WinTheDayRule[]

  @@index([agencyId])
}

model WinTheDayRule {
  id             String        @id @default(cuid())
  planId         String
  orderIndex     Int           @default(0)
  sourceType     WinSourceType
  activityTypeId String?
  unitsPerPoint  Float?
  pointsAwarded  Float         @default(1)
  notes          String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  activityType   ActivityType? @relation(fields: [activityTypeId], references: [id], onDelete: SetNull)
  plan           WinTheDayPlan @relation(fields: [planId], references: [id], onDelete: Cascade)

  @@index([planId])
  @@index([activityTypeId])
}

model WinTheDayPlanTeamAssignment {
  id        String        @id @default(cuid())
  planId    String
  teamId    String        @unique
  active    Boolean       @default(true)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  plan      WinTheDayPlan @relation(fields: [planId], references: [id], onDelete: Cascade)
  team      Team          @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@index([planId])
}

model WinTheDayPlanPersonAssignment {
  id         String        @id @default(cuid())
  planId     String
  personId   String?       @unique
  personName String?
  active     Boolean       @default(true)
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  person     Person?       @relation(fields: [personId], references: [id], onDelete: SetNull)
  plan       WinTheDayPlan @relation(fields: [planId], references: [id], onDelete: Cascade)

  @@index([planId])
}

model CompPlan {
  id                       String               @id @default(cuid())
  agencyId                 String?
  name                     String
  description              String?
  status                   CompPlanStatus       @default(DRAFT)
  active                   Boolean              @default(true)
  archivedAt               DateTime?
  defaultStatusEligibility PolicyStatus[]
  effectiveStartMonth      String?
  createdAt                DateTime             @default(now())
  updatedAt                DateTime             @updatedAt
  agency                   Agency?              @relation(fields: [agencyId], references: [id], onDelete: Cascade)
  assignments              CompPlanAssignment[]
  versions                 CompPlanVersion[]
}

model CompPlanVersion {
  id                  String                @id @default(cuid())
  planId              String
  effectiveStartMonth String?
  createdAt           DateTime              @default(now())
  isCurrent           Boolean               @default(true)
  config              Json?                 @db.JsonB
  bonusModules        CompPlanBonusModule[]
  gates               CompPlanGate[]
  ruleBlocks          CompPlanRuleBlock[]
  plan                CompPlan              @relation(fields: [planId], references: [id], onDelete: Cascade)

  @@index([planId])
}

model CompPlanRuleBlock {
  id                        String            @id @default(cuid())
  planVersionId             String
  name                      String
  enabled                   Boolean           @default(true)
  orderIndex                Int               @default(0)
  ruleType                  CompRuleType
  statusEligibilityOverride PolicyStatus[]
  applyScope                CompApplyScope
  applyFilters              Json?
  payoutType                CompPayoutType
  basePayoutValue           Float?
  tierMode                  CompTierMode
  tierBasis                 CompTierBasis?
  bucketId                  String?
  minThreshold              Float?
  gateBehavior              CompGateBehavior?
  notes                     String?
  maxPayout                 Float?
  version                   CompPlanVersion   @relation(fields: [planVersionId], references: [id], onDelete: Cascade)
  tiers                     CompPlanTierRow[]

  @@index([planVersionId])
}

model CompPlanTierRow {
  id          String            @id @default(cuid())
  ruleBlockId String
  minValue    Float
  maxValue    Float?
  payoutValue Float
  payoutUnit  String?
  orderIndex  Int               @default(0)
  ruleBlock   CompPlanRuleBlock @relation(fields: [ruleBlockId], references: [id], onDelete: Cascade)

  @@index([ruleBlockId])
}

model CompPlanGate {
  id             String           @id @default(cuid())
  planVersionId  String
  enabled        Boolean          @default(true)
  name           String
  gateType       CompGateType
  bucketId       String?
  thresholdValue Float
  behavior       CompGateBehavior
  scope          CompGateScope
  ruleBlockIds   String[]
  version        CompPlanVersion  @relation(fields: [planVersionId], references: [id], onDelete: Cascade)

  @@index([planVersionId])
}

model CompPlanBonusModule {
  id              String                  @id @default(cuid())
  planVersionId   String
  enabled         Boolean                 @default(true)
  name            String
  bonusType       CompBonusType
  config          Json?
  highestTierWins Boolean                 @default(true)
  stackTiers      Boolean                 @default(false)
  version         CompPlanVersion         @relation(fields: [planVersionId], references: [id], onDelete: Cascade)
  scorecardTiers  CompPlanScorecardTier[]

  @@index([planVersionId])
}

model CompPlanScorecardTier {
  id                    String                       @id @default(cuid())
  bonusModuleId         String
  name                  String
  orderIndex            Int                          @default(0)
  requiresAllConditions Boolean                      @default(true)
  conditionGroups       CompPlanScorecardConditionGroup[]
  conditions            CompPlanScorecardCondition[]
  rewards               CompPlanScorecardReward[]
  bonusModule           CompPlanBonusModule          @relation(fields: [bonusModuleId], references: [id], onDelete: Cascade)

  @@index([bonusModuleId])
}

model CompPlanScorecardConditionGroup {
  id         String                       @id @default(cuid())
  tierId     String
  name       String                       @default("")
  mode       CompScorecardConditionGroupMode
  orderIndex Int                          @default(0)
  tier       CompPlanScorecardTier        @relation(fields: [tierId], references: [id], onDelete: Cascade)
  conditions CompPlanScorecardCondition[]

  @@index([tierId])
}

model CompPlanScorecardCondition {
  id             String                @id @default(cuid())
  tierId         String
  groupId        String?
  metricSource   CompMetricSource
  bucketId       String?
  activityTypeId String?
  operator       ConditionOperator
  value          Float
  statusFilter   PolicyStatus?
  timeframe      String?
  filters        Json?
  tier           CompPlanScorecardTier @relation(fields: [tierId], references: [id], onDelete: Cascade)
  group          CompPlanScorecardConditionGroup? @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@index([tierId])
  @@index([groupId])
}

model CompPlanScorecardReward {
  id              String                @id @default(cuid())
  tierId          String
  rewardType      CompRewardType
  bucketId        String?
  premiumCategory PremiumCategory?
  percentValue    Float?
  dollarValue     Float?
  tier            CompPlanScorecardTier @relation(fields: [tierId], references: [id], onDelete: Cascade)

  @@index([tierId])
}

model CompPlanAssignment {
  id                  String              @id @default(cuid())
  planId              String
  scopeType           CompAssignmentScope
  scopeId             String?
  effectiveStartMonth String?
  active              Boolean             @default(true)
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  plan                CompPlan            @relation(fields: [planId], references: [id], onDelete: Cascade)

  @@index([planId])
  @@index([scopeType, scopeId])
}

model CompMonthlyResult {
  id            String   @id @default(cuid())
  agencyId      String?
  personId      String?
  personName    String?
  month         String
  planId        String
  planVersionId String
  baseEarnings  Float
  bonusEarnings Float
  totalEarnings Float
  bucketValues  Json
  breakdown     Json
  computedAt    DateTime @default(now())
  agency        Agency?  @relation(fields: [agencyId], references: [id], onDelete: Cascade)

  @@index([agencyId, month])
  @@index([personId, month])
  @@index([planId, month])
}

model ProductionExpectation {
  id                  String          @id @default(cuid())
  agencyId            String?
  roleId              String
  lineOfBusinessId    String?
  activityTypeId      String?
  monthKey            String?
  targetApps          Float?
  targetPremium       Float?
  targetActivityCount Float?
  notes               String?
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt
  activityType        ActivityType?   @relation(fields: [activityTypeId], references: [id], onDelete: Cascade)
  agency              Agency?         @relation(fields: [agencyId], references: [id], onDelete: Cascade)
  lineOfBusiness      LineOfBusiness? @relation(fields: [lineOfBusinessId], references: [id], onDelete: Cascade)
  role                Role            @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([roleId, lineOfBusinessId, activityTypeId, monthKey])
  @@index([agencyId])
  @@index([roleId])
  @@index([lineOfBusinessId])
  @@index([activityTypeId])
}

model ReportPreset {
  id          String   @id @default(cuid())
  agencyId    String?
  name        String
  description String?
  configJson  Json
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  agency      Agency?  @relation(fields: [agencyId], references: [id], onDelete: Cascade)

  @@index([agencyId])
}

model ReportSnapshot {
  id          String   @id @default(cuid())
  agencyId    String
  reportType  String
  createdAt   DateTime @default(now())
  startISO    String
  endISO      String
  statusesCSV String
  payloadJson Json
  metaJson    Json?
  title       String?  @db.VarChar(140)
  agency      Agency   @relation(fields: [agencyId], references: [id], onDelete: Cascade)

  @@index([agencyId])
  @@index([reportType, createdAt])
  @@index([reportType, startISO, endISO])
}

model RoiCommissionRate {
  id             String    @id @default(cuid())
  orgId          String
  lob            String
  rate           Float
  effectiveStart DateTime
  effectiveEnd   DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@index([orgId, lob])
  @@index([effectiveStart, effectiveEnd])
}

model RoiCompPlan {
  id             String    @id @default(cuid())
  orgId          String
  personId       String
  monthlySalary  Float
  effectiveStart DateTime
  effectiveEnd   DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  person         Person    @relation(fields: [personId], references: [id], onDelete: Cascade)

  @@index([orgId, personId])
  @@index([effectiveStart, effectiveEnd])
}

model RoiMonthlyInputs {
  id                 String   @id @default(cuid())
  orgId              String
  personId           String
  month              String
  commissionPaid     Float
  leadSpend          Float?
  notes              String?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  otherBonusesManual Float?   @default(0)
  marketingExpenses  Float?   @default(0)
  person             Person   @relation(fields: [personId], references: [id], onDelete: Cascade)

  @@unique([orgId, personId, month])
  @@index([orgId, month])
}

model BenchOfficePlan {
  id                   String             @id @default(cuid())
  agencyId             String
  year                 Int
  appsAnnualTarget     Int
  premiumAnnualTarget  Float
  premiumMode          PremiumTargetMode
  premiumByLob         Json?
  premiumByBucket      Json?
  appGoalsByLobJson    Json?
  premiumByBucketJson  Json?
  premiumFsBreakdownJson Json?
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
  agency               Agency             @relation(fields: [agencyId], references: [id], onDelete: Cascade)

  @@unique([agencyId, year])
  @@index([agencyId])
}

model BenchRoleExpectation {
  id                    String             @id @default(cuid())
  roleId                String             @unique
  monthlyAppsTarget     Int
  monthlyPremiumTarget  Float
  premiumMode           PremiumTargetMode
  premiumByLob          Json?
  premiumByBucket       Json?
  appGoalsByLobJson     Json?
  activityTargetsByTypeJson Json?
  createdAt             DateTime           @default(now())
  updatedAt             DateTime           @updatedAt
  role                  Role               @relation(fields: [roleId], references: [id], onDelete: Cascade)
}

model BenchPersonOverride {
  id                      String             @id @default(cuid())
  personId                String             @unique
  monthlyAppsOverride     Int?
  monthlyPremiumOverride  Float?
  premiumModeOverride     PremiumTargetMode?
  premiumByLobOverride    Json?
  premiumByBucketOverride Json?
  appGoalsByLobOverrideJson Json?
  activityTargetsByTypeOverrideJson Json?
  createdAt               DateTime           @default(now())
  updatedAt               DateTime           @updatedAt
  person                  Person             @relation(fields: [personId], references: [id], onDelete: Cascade)
}

enum PremiumCategory {
  PC
  FS
  IPS
}

enum ProductType {
  PERSONAL
  BUSINESS
}

enum PolicyStatus {
  WRITTEN
  ISSUED
  PAID
  CANCELLED
  STATUS_CHECK
}

enum TeamType {
  SALES
  CS
}

enum CompRuleType {
  BASE
  OVERRIDE
  KICKER
}

enum CompApplyScope {
  PRODUCT
  LOB
  PRODUCT_TYPE
  PREMIUM_CATEGORY
  BUCKET
}

enum CompPayoutType {
  FLAT_PER_APP
  PERCENT_OF_PREMIUM
  FLAT_LUMP_SUM
}

enum CompTierMode {
  NONE
  TIERS
}

enum CompTierBasis {
  APP_COUNT
  PREMIUM_SUM
  BUCKET_VALUE
}

enum CompGateType {
  MIN_APPS
  MIN_PREMIUM
  MIN_BUCKET
}

enum CompGateBehavior {
  HARD_GATE
  RETROACTIVE
  NON_RETROACTIVE
}

enum CompGateScope {
  PLAN
  RULE_BLOCKS
  PRODUCTS
}

enum CompBonusType {
  SCORECARD_TIER
  GOAL_BONUS
  ACTIVITY_BONUS
  WTD_BONUS
  PRODUCT_BONUS
  CUSTOM
}

enum CompMetricSource {
  BUCKET
  ACTIVITY
  WTD
  APPS_COUNT
  PREMIUM_CATEGORY
  TOTAL_PREMIUM
}

enum CompRewardType {
  ADD_PERCENT_OF_BUCKET
  ADD_FLAT_DOLLARS
  MULTIPLIER
}

enum ConditionOperator {
  GTE
  GT
  LTE
  LT
  EQ
}

enum CompScorecardConditionGroupMode {
  ALL
  ANY
}

enum CompAssignmentScope {
  PERSON
  ROLE
  TEAM
  TEAM_TYPE
  AGENCY
}

enum CompPlanStatus {
  DRAFT
  ACTIVE
  ARCHIVED
}

enum ActivityInputMode {
  COUNT
  BOOLEAN
  TEXT
}

enum ActivityGroupingHint {
  BULK
  PER_ENTRY
}

enum WinSourceType {
  ACTIVITY
  WRITTEN_APPS
}

enum PremiumTargetMode {
  LOB
  BUCKET
}

enum CommissionScope {
  AGENCY
  TEAM
  ROLE
  PERSON
  TEAM_TYPE
}
